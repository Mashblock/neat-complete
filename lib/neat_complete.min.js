// neat_complete v1.1.0 
//
// (c) 2014 Able Technology Consulting Ltd. 
// http://abletech.github.com/neat-complete/doc/LICENSE.md.html
(function(){var t,e=[].slice;null==(t=window.NeatComplete)&&(window.NeatComplete={}),NeatComplete.Dispatch=function(){function t(){}return t.prototype.setOption=function(t,e){return this.options[t]=e,this},t.prototype.getOption=function(t){return this.options[t]},t.prototype.on=function(t,e){var s,i,n;return null==(i=this.subs)&&(this.subs={}),null==(n=(s=this.subs)[t])&&(s[t]=[]),this.subs[t].push(e),this},t.prototype.trigger=function(){var t,s,i,n,o,r,h;if(i=arguments[0],t=arguments.length>=2?e.call(arguments,1):[],null!=(null!=(r=this.subs)?r[i]:void 0))for(h=this.subs[i],n=0,o=h.length;o>n;n++)s=h[n],s.apply(this,t);return this},t}()}).call(this),function(){var t;null==(t=window.NeatComplete)&&(window.NeatComplete={}),NeatComplete.addDomEvent=function(t,e,s){return null!=t.attachEvent?(t["e"+e+s]=s,t[""+e+s]=function(){return t["e"+e+s](window.event)},t.attachEvent("on"+e,t[""+e+s])):t.addEventListener(e,s,!1)},NeatComplete.removeDomEvent=function(t,e,s){return null!=t.detachEvent?t.detachEvent("on"+e,t[""+e+s]):t.removeEventListener(e,s,!1)},Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e,s,i,n;if(this===void 0||null===this)throw new TypeError;if(n=Object(this),s=n.length>>>0,0===s)return-1;if(i=0,arguments.length>0&&(i=Number(arguments[1]),i!==i?i=0:0!==i&&1/0!==i&&i!==-1/0&&(i=(i>0||-1)*Math.floor(Math.abs(i)))),i>=s)return-1;for(e=i>=0?i:Math.max(s-Math.abs(i),0);s>e;){if(e in n&&n[e]===t)return e;e++}return-1})}.call(this),function(){var t;null==(t=window.NeatComplete)&&(window.NeatComplete={}),NeatComplete._Result=function(){function t(t,e){var s,i,n,o;this.service=t,this.options=e,this.widget=this.service.widget,this.renderer=this.service.options.renderer||this.widget.options.renderer,this.value=null!=(s=this.options)?s.value:void 0,this.score=(null!=(i=this.options)?i.score:void 0)||0,this.identifier=null!=(n=this.options)?n.identifier:void 0,this.data=(null!=(o=this.options)?o.data:void 0)||{}}return t.prototype.render=function(){return this.li=document.createElement("li"),this.li.innerHTML=null!=this.renderer?this.renderer(this.value,this.data):this.value,this.li.className=this.widget.options.item_class,this.addEvents(),this.li},t.prototype.addEvents=function(){var t=this;return NeatComplete.addDomEvent(this.li,"click",function(e){return t.selectItem(),e.preventDefault?e.preventDefault():e.returnValue=!1}),NeatComplete.addDomEvent(this.li,"mouseover",function(){return t.highlight()}),NeatComplete.addDomEvent(this.li,"mouseout",function(){return t.unhighlight()}),NeatComplete.addDomEvent(this.li,"mousedown",function(){return t.widget.mouseDownOnSelect=!0}),NeatComplete.addDomEvent(this.li,"mouseup",function(){return t.widget.mouseDownOnSelect=!1})},t.prototype.selectItem=function(){return this.service.trigger("result:select",this.value,this.data),this.widget.highlighted=this,this.widget.selectHighlighted()},t.prototype.highlight=function(){var t;return null!=(t=this.widget.highlighted)&&t.unhighlight(),this.li.className=""+this.li.className+" "+this.widget.options.hover_class,this.widget.highlighted=this},t.prototype.unhighlight=function(){return this.widget.highlighted=null,this.li.className=this.li.className.replace(RegExp(this.widget.options.hover_class,"gi"),"")},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};null==(t=window.NeatComplete)&&(window.NeatComplete={}),NeatComplete.Service=function(t){function s(t,s,i,n){var o=this;this.widget=t,this.name=s,this.search_fn=i,this.options=null!=n?n:{},this._response=e(this._response,this),this.results=[],this.response=function(){return o._response.apply(o,arguments)}}return i(s,t),s.prototype.search=function(t){return this.last_query=t,this.ready=!1,this.search_fn(t,this.response)},s.prototype._response=function(t,e){var s,i,n;if(this.results=[],this.last_query===t){for(this.results=[],i=0,n=e.length;n>i;i++)s=e[i],this.results.push(new NeatComplete._Result(this,s));return this.ready=!0,this.widget.showResults()}},s}(NeatComplete.Dispatch)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,s=function(t,s){function i(){this.constructor=t}for(var n in s)e.call(s,n)&&(t[n]=s[n]);return i.prototype=s.prototype,t.prototype=new i,t.__super__=s.prototype,t};NeatComplete.Widget=function(e){function i(e,s){this.element=e,this.options=null!=s?s:{},this._onBlur=t(this._onBlur,this),this._onKeyDown=t(this._onKeyDown,this),this._onKeyPress=t(this._onKeyPress,this),this._onFocus=t(this._onFocus,this),this.enabled=!0,this.element.setAttribute("autocomplete","off"),this.services=[],this._applyDefaults(),this._addListeners(),this.output=document.createElement("ul"),this.output.className=this.options.list_class,this._applyStyle("display","none"),this._applyStyle("position",this.options.position),this.options.container.appendChild(this.output)}return s(i,e),i.prototype.defaults={max_results:10,list_class:"nc_list",item_class:"nc_item",hover_class:"nc_hover",footer_class:"nc_footer",empty_class:"nc_empty",error_class:"nc_error",position:"absolute",container:document.body},i.prototype.addService=function(t,e,s){var i;return null==s&&(s={}),this.services.push(i=new NeatComplete.Service(this,t,e,s)),i},i.prototype.disable=function(){return this.enabled=!1,this},i.prototype.enable=function(){return this.enabled=!0,this},i.prototype.destroy=function(){document.body.removeChild(this.output),this.element.removeAttribute("autocomplete")},i.prototype._applyDefaults=function(){var t,e,s,i;s=this.defaults,i=[];for(t in s)e=s[t],null==this.getOption(t)?i.push(this.setOption(t,e)):i.push(void 0);return i},i.prototype._addListeners=function(){return NeatComplete.addDomEvent(this.element,"focus",this._onFocus),NeatComplete.addDomEvent(this.element,"keypress",this._onKeyPress),NeatComplete.addDomEvent(this.element,"keydown",this._onKeyDown),NeatComplete.addDomEvent(this.element,"blur",this._onBlur)},i.prototype._removeListeners=function(){return NeatComplete.removeDomEvent(this.element,"focus",this._onFocus),NeatComplete.removeDomEvent(this.element,"keypress",this._onKeyPress),NeatComplete.removeDomEvent(this.element,"keydown",this._onKeyDown),NeatComplete.removeDomEvent(this.element,"blur",this._onBlur)},i.prototype._onFocus=function(){return this.focused=!0},i.prototype._onKeyPress=function(t){var e,s;return e=t.which||t.keyCode,this.visible&&13===e?(null!=(s=this.highlighted)&&s.selectItem(),t.preventDefault?t.preventDefault():t.returnValue=!1,!1):void 0},i.prototype._onKeyDown=function(t){var e,s,i=this;switch(e=t.which||t.keyCode){case 38:return this.visible&&this._moveHighlight(-1),!1;case 40:return this.visible&&this._moveHighlight(1),!1;case 9:if(this.visible)return null!=(s=this.highlighted)?s.selectItem():void 0;break;case 27:return this._hideResults();case 37:case 39:case 13:break;default:return null!=this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(){return i._getSuggestions()},400)}},i.prototype._onBlur=function(){return this.mouseDownOnSelect?void 0:(this.focused=!1,this._hideResults())},i.prototype._moveHighlight=function(t){var e,s,i;return e=null!=this.highlighted?this.results.indexOf(this.highlighted):-1,null!=(s=this.highlighted)&&s.unhighlight(),e+=t,-1>e?e=this.results.length-1:e>=this.results.length&&(e=-1),null!=(i=this.results[e])&&i.highlight(),this.element.value=null!=this.highlighted?this.highlighted.value:this._val},i.prototype._getSuggestions=function(){var t,e,s,i,n;if(this.enabled){if(this._val=this.element.value,this.error_content=null,""!==this._val){for(i=this.services,n=[],e=0,s=i.length;s>e;e++)t=i[e],n.push(t.search(this._val));return n}return this._hideResults()}},i.prototype._applyStyle=function(t,e){return this.output.style[t]=e},i.prototype._getPosition=function(){var t,e;for(e=this.element,t={top:e.offsetTop+e.offsetHeight,left:e.offsetLeft};e=e.offsetParent;)t.top+=e.offsetTop,t.left+=e.offsetLeft;return t},i.prototype._hideResults=function(){var t,e,s,i,n;for(this.visible=!1,this._applyStyle("display","none"),this.results=[],i=this.services,n=[],e=0,s=i.length;s>e;e++)t=i[e],n.push(t.results=[]);return n},i.prototype._displayResults=function(){var t;return this.visible=!0,t=this._getPosition(),this.options.container===document.body&&(this._applyStyle("left",""+t.left+"px"),this._applyStyle("top",""+t.top+"px")),this._applyStyle("display","block")},i.prototype._renderItem=function(t,e){var s,i=this;return s=document.createElement("li"),s.innerHTML=t,null!=e&&(s.className=e),NeatComplete.addDomEvent(s,"mousedown",function(){return i.mouseDownOnSelect=!0}),NeatComplete.addDomEvent(s,"mouseup",function(){return i.mouseDownOnSelect=!1}),s},i.prototype._renderFooter=function(){return this._renderItem(this.options.footer_content,this.options.footer_class)},i.prototype._renderEmpty=function(){return this._renderItem(this.options.empty_content,this.options.empty_class)},i.prototype._servicesReady=function(){var t,e,s,i,n;for(e=[],n=this.services,s=0,i=n.length;i>s;s++)t=n[s],e.push(t.ready);return 0>e.indexOf(!1)},i.prototype.showResults=function(){var t,e,s,i,n,o,r,h,l;if(this._servicesReady()){for(this.results=[],this.output.innerHTML="",h=this.services,i=0,o=h.length;o>i;i++)s=h[i],this.results=this.results.concat(s.results);if(this.results.length){for(this.results=this.results.sort(function(t,e){return e.score-t.score}),this.results=this.results.slice(0,+(this.getOption("max_results")-1)+1||9e9),l=this.results,n=0,r=l.length;r>n;n++)e=l[n],this.output.appendChild(e.render());null!=this.options.footer_content&&""!==(t=this._renderFooter())&&this.output.appendChild(t),this._displayResults()}else this.error_content?(this.output.appendChild(this._renderItem(this.error_content,this.options.error_class)),this._displayResults()):(null!=this.options.empty_content?(this.output.appendChild(this._renderEmpty()),this._displayResults()):this._hideResults(),this.trigger("results:empty"));this.trigger("results:update")}},i.prototype.selectHighlighted=function(){this.element.value=this.highlighted.value,this._hideResults(),this.trigger("result:select",this.highlighted.value,this.highlighted.data)},i}(NeatComplete.Dispatch)}.call(this);