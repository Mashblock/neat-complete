// Generated by CoffeeScript 1.3.1
((function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].slice;window.NeatComplete==null&&(window.NeatComplete={}),NeatComplete.addDomEvent=function(a,b,c){return a.attachEvent!=null?(a["e"+b+c]=c,a[""+b+c]=function(){return a["e"+b+c](window.event)},a.attachEvent("on"+b,a[""+b+c])):a.addEventListener(b,c,!1)},window.NeatComplete==null&&(window.NeatComplete={}),NeatComplete._Result=function(){function a(a,b){var c,d,e,f;this.service=a,this.options=b,this.widget=this.service.widget,this.renderer=this.service.options.renderer||this.widget.options.renderer,this.value=(c=this.options)!=null?c.value:void 0,this.score=((d=this.options)!=null?d.score:void 0)||0,this.identifier=(e=this.options)!=null?e.identifier:void 0,this.data=((f=this.options)!=null?f.data:void 0)||{}}return a.name="_Result",a.prototype.render=function(){return this.li=document.createElement("li"),this.li.innerHTML=this.renderer!=null?this.renderer(this.value,this.data):this.value,this.li.setAttribute("class",this.widget.item_class),this.addEvents(),this.li},a.prototype.addEvents=function(){var a=this;return NeatComplete.addDomEvent(this.li,"click",function(b){return a.selectItem(),b.preventDefault?b.preventDefault():b.returnValue=!1}),NeatComplete.addDomEvent(this.li,"mouseover",function(){return a.highlight()}),NeatComplete.addDomEvent(this.li,"mouseout",function(){return a.unhighlight()}),NeatComplete.addDomEvent(this.li,"mousedown",function(){return a.widget.mouseDownOnSelect=!0}),NeatComplete.addDomEvent(this.li,"mouseup",function(){return a.widget.mouseDownOnSelect=!1})},a.prototype.selectItem=function(){return this.widget.selectHighlighted()},a.prototype.highlight=function(){var a;return(a=this.widget.highlighted)!=null&&a.unhighlight(),this.li.className=""+this.li.className+" "+this.widget.hover_class,this.widget.highlighted=this},a.prototype.unhighlight=function(){return this.widget.highlighted=null,this.li.className=this.li.className.replace(new RegExp(this.widget.hover_class,"gi"),"")},a}(),window.NeatComplete==null&&(window.NeatComplete={}),NeatComplete._Service=function(){function b(b,c,d,e){var f=this;this.widget=b,this.name=c,this.search_fn=d,this.options=e!=null?e:{},this._response=a(this._response,this),this.results=[],this.response=function(a,b){return f._response.apply(f,arguments)}}return b.name="_Service",b.prototype.search=function(a){return this.last_query=a,this.ready=!1,this.search_fn(a,this.response)},b.prototype._response=function(a,b){var c,d,e;this.results=[];if(this.last_query===a){this.results=[];for(d=0,e=b.length;d<e;d++)c=b[d],this.results.push(new NeatComplete._Result(this,c));return this.ready=!0,this.widget.showResults()}},b}(),window.NeatComplete==null&&(window.NeatComplete={}),NeatComplete.Widget=function(){function a(a,b){this.element=a,this.options=b!=null?b:{},this.element.setAttribute("autocomplete","off"),this.services=[],this._addListeners(),this.output=document.createElement("ul"),this.output.setAttribute("class",this.list_class),this._applyStyle("display","none"),this._applyStyle("position","absolute"),document.body.appendChild(this.output),this}return a.name="Widget",a.prototype.max_results=10,a.prototype.list_class="nc_list",a.prototype.item_class="nc_item",a.prototype.hover_class="nc_hover",a.prototype.footer_class="nc_footer",a.prototype.empty_class="nc_empty",a.prototype.addService=function(a,b){return this.services.push(new NeatComplete._Service(this,a,b)),this},a.prototype.setOption=function(a,b){return this.options[a]=b,this},a.prototype.getOption=function(a){return this.options[a]},a.prototype.on=function(a,b){var c;return this.subs==null&&(this.subs={}),(c=this.subs)[a]==null&&(c[a]=[]),this.subs[a].push(b),this},a.prototype.trigger=function(){var a,c,d,e,f,g,h;d=arguments[0],a=2<=arguments.length?b.call(arguments,1):[];if(((g=this.subs)!=null?g[d]:void 0)!=null){h=this.subs[d];for(e=0,f=h.length;e<f;e++)c=h[e],c.apply(null,a)}return this},a.prototype._addListeners=function(){var a=this;return NeatComplete.addDomEvent(this.element,"focus",function(b){return a.focused=!0}),NeatComplete.addDomEvent(this.element,"keypress",function(b){var c,d;c=b.which||b.keyCode;if(c===13)return(d=a.highlighted)!=null&&d.selectItem(),b.preventDefault?b.preventDefault():b.returnValue=!1,!1}),NeatComplete.addDomEvent(this.element,"keydown",function(b){var c,d;c=b.which||b.keyCode;switch(c){case 38:return a._moveHighlight(-1),!1;case 40:return a._moveHighlight(1),!1;case 9:return(d=a.highlighted)!=null?d.selectItem():void 0;case 27:return a._hideResults();case 37:case 39:case 13:break;default:return a._timeout!=null&&clearTimeout(a._timeout),a._timeout=setTimeout(function(){return a._getSuggestions()},400)}}),NeatComplete.addDomEvent(this.element,"blur",function(b){if(!a.mouseDownOnSelect)return a.focused=!1,a._hideResults()})},a.prototype._moveHighlight=function(a){var b,c,d;return b=this.highlighted!=null?this.results.indexOf(this.highlighted):-1,(c=this.highlighted)!=null&&c.unhighlight(),b+=a,b<-1?b=this.results.length-1:b>=this.results.length&&(b=-1),(d=this.results[b])!=null&&d.highlight(),this.element.value=this.highlighted!=null?this.highlighted.value:this._val},a.prototype._getSuggestions=function(){var a,b,c,d,e;this._val=this.element.value;if(this._val!==""){d=this.services,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.search(this._val));return e}return this._hideResults()},a.prototype._applyStyle=function(a,b){return this.output.style[a]=b},a.prototype._getPosition=function(){var a,b;b=this.element,a={top:b.offsetTop+b.offsetHeight,left:b.offsetLeft};while(b=b.offsetParent)a.top+=b.offsetTop,a.left+=b.offsetLeft;return a},a.prototype._hideResults=function(){var a,b,c,d,e;this._applyStyle("display","none"),this.results=[],d=this.services,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.results=[]);return e},a.prototype._displayResults=function(){var a;return a=this._getPosition(),this._applyStyle("left",""+a.left+"px"),this._applyStyle("top",""+a.top+"px"),this._applyStyle("display","block")},a.prototype._renderItem=function(a,b){var c;return c=document.createElement("li"),c.innerHTML=a,b!=null&&c.setAttribute("class",b),c},a.prototype._renderFooter=function(){return this._renderItem(this.options.footerContent,"nc_footer")},a.prototype._renderEmpty=function(){return this._renderItem(this.options.emptyContent,"nc_empty")},a.prototype._servicesReady=function(){var a,b,c,d,e;b=[],e=this.services;for(c=0,d=e.length;c<d;c++)a=e[c],b.push(a.ready);return b.indexOf(!1)<0},a.prototype.showResults=function(){var a,b,c,d,e,f,g,h;if(this._servicesReady()){this.results=[],this.output.innerHTML="",g=this.services;for(c=0,e=g.length;c<e;c++)b=g[c],this.results=this.results.concat(b.results);if(this.results.length){this.results=this.results.sort(function(a,b){return b.score-a.score}),this.results=this.results.slice(0,this.max_results-1+1||9e9),h=this.results;for(d=0,f=h.length;d<f;d++)a=h[d],this.output.appendChild(a.render());this.options.footerContent!=null&&this.output.appendChild(this._renderFooter()),this._displayResults()}else this.options.emptyContent!=null?(this.output.appendChild(this._renderEmpty()),this._displayResults(),this.trigger("results:empty")):this._hideResults();return this.trigger("results:update")}},a.prototype.selectHighlighted=function(){return this.element.value=this.highlighted.value,this._hideResults(),this.trigger("result:select",this.highlighted.value,this.highlighted.data)},a}()})).call(this);