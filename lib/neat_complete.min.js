// Generated by CoffeeScript 1.3.1
((function(){"use strict";var a=[].slice,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};window.NeatComplete==null&&(window.NeatComplete={}),NeatComplete.Dispatch=function(){function b(){}return b.name="Dispatch",b.prototype.setOption=function(a,b){return this.options[a]=b,this},b.prototype.getOption=function(a){return this.options[a]},b.prototype.on=function(a,b){var c;return this.subs==null&&(this.subs={}),(c=this.subs)[a]==null&&(c[a]=[]),this.subs[a].push(b),this},b.prototype.trigger=function(){var b,c,d,e,f,g,h;d=arguments[0],b=2<=arguments.length?a.call(arguments,1):[];if(((g=this.subs)!=null?g[d]:void 0)!=null){h=this.subs[d];for(e=0,f=h.length;e<f;e++)c=h[e],c.apply(null,b)}return this},b}(),window.NeatComplete==null&&(window.NeatComplete={}),NeatComplete.addDomEvent=function(a,b,c){return a.attachEvent!=null?(a["e"+b+c]=c,a[""+b+c]=function(){return a["e"+b+c](window.event)},a.attachEvent("on"+b,a[""+b+c])):a.addEventListener(b,c,!1)},window.NeatComplete==null&&(window.NeatComplete={}),NeatComplete._Result=function(){function a(a,b){var c,d,e,f;this.service=a,this.options=b,this.widget=this.service.widget,this.renderer=this.service.options.renderer||this.widget.options.renderer,this.value=(c=this.options)!=null?c.value:void 0,this.score=((d=this.options)!=null?d.score:void 0)||0,this.identifier=(e=this.options)!=null?e.identifier:void 0,this.data=((f=this.options)!=null?f.data:void 0)||{}}return a.name="_Result",a.prototype.render=function(){return this.li=document.createElement("li"),this.li.innerHTML=this.renderer!=null?this.renderer(this.value,this.data):this.value,this.li.setAttribute("class",this.widget.options.item_class),this.addEvents(),this.li},a.prototype.addEvents=function(){var a=this;return NeatComplete.addDomEvent(this.li,"click",function(b){return a.selectItem(),b.preventDefault?b.preventDefault():b.returnValue=!1}),NeatComplete.addDomEvent(this.li,"mouseover",function(){return a.highlight()}),NeatComplete.addDomEvent(this.li,"mouseout",function(){return a.unhighlight()}),NeatComplete.addDomEvent(this.li,"mousedown",function(){return a.widget.mouseDownOnSelect=!0}),NeatComplete.addDomEvent(this.li,"mouseup",function(){return a.widget.mouseDownOnSelect=!1})},a.prototype.selectItem=function(){return this.widget.selectHighlighted()},a.prototype.highlight=function(){var a;return(a=this.widget.highlighted)!=null&&a.unhighlight(),this.li.className=""+this.li.className+" "+this.widget.options.hover_class,this.widget.highlighted=this},a.prototype.unhighlight=function(){return this.widget.highlighted=null,this.li.className=this.li.className.replace(new RegExp(this.widget.options.hover_class,"gi"),"")},a}(),window.NeatComplete==null&&(window.NeatComplete={}),NeatComplete._Service=function(a){function c(a,c,d,e){var f=this;this.widget=a,this.name=c,this.search_fn=d,this.options=e!=null?e:{},this._response=b(this._response,this),this.results=[],this.response=function(a,b){return f._response.apply(f,arguments)}}return d(c,a),c.name="_Service",c.prototype.search=function(a){return this.last_query=a,this.ready=!1,this.search_fn(a,this.response)},c.prototype._response=function(a,b){var c,d,e;this.results=[];if(this.last_query===a){this.results=[];for(d=0,e=b.length;d<e;d++)c=b[d],this.results.push(new NeatComplete._Result(this,c));return this.ready=!0,this.widget.showResults()}},c}(NeatComplete.Dispatch),NeatComplete.Widget=function(a){function b(a,b){this.element=a,this.options=b!=null?b:{},this.element.setAttribute("autocomplete","off"),this.services=[],this._applyDefaults(),this._addListeners(),this.output=document.createElement("ul"),this.output.setAttribute("class",this.options.list_class),this._applyStyle("display","none"),this._applyStyle("position","absolute"),document.body.appendChild(this.output),this}return d(b,a),b.name="Widget",b.prototype.defaults={max_results:10,list_class:"nc_list",item_class:"nc_item",hover_class:"nc_hover",footer_class:"nc_footer",empty_class:"nc_empty"},b.prototype.addService=function(a,b,c){return c==null&&(c={}),this.services.push(new NeatComplete._Service(this,a,b,c)),this},b.prototype._applyDefaults=function(){var a,b,c,d;c=this.defaults,d=[];for(a in c)b=c[a],this.getOption(a)==null?d.push(this.setOption(a,b)):d.push(void 0);return d},b.prototype._addListeners=function(){var a=this;return NeatComplete.addDomEvent(this.element,"focus",function(b){return a.focused=!0}),NeatComplete.addDomEvent(this.element,"keypress",function(b){var c,d;c=b.which||b.keyCode;if(c===13)return(d=a.highlighted)!=null&&d.selectItem(),b.preventDefault?b.preventDefault():b.returnValue=!1,!1}),NeatComplete.addDomEvent(this.element,"keydown",function(b){var c,d;c=b.which||b.keyCode;switch(c){case 38:return a._moveHighlight(-1),!1;case 40:return a._moveHighlight(1),!1;case 9:return(d=a.highlighted)!=null?d.selectItem():void 0;case 27:return a._hideResults();case 37:case 39:case 13:break;default:return a._timeout!=null&&clearTimeout(a._timeout),a._timeout=setTimeout(function(){return a._getSuggestions()},400)}}),NeatComplete.addDomEvent(this.element,"blur",function(b){if(!a.mouseDownOnSelect)return a.focused=!1,a._hideResults()})},b.prototype._moveHighlight=function(a){var b,c,d;return b=this.highlighted!=null?this.results.indexOf(this.highlighted):-1,(c=this.highlighted)!=null&&c.unhighlight(),b+=a,b<-1?b=this.results.length-1:b>=this.results.length&&(b=-1),(d=this.results[b])!=null&&d.highlight(),this.element.value=this.highlighted!=null?this.highlighted.value:this._val},b.prototype._getSuggestions=function(){var a,b,c,d,e;this._val=this.element.value;if(this._val!==""){d=this.services,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.search(this._val));return e}return this._hideResults()},b.prototype._applyStyle=function(a,b){return this.output.style[a]=b},b.prototype._getPosition=function(){var a,b;b=this.element,a={top:b.offsetTop+b.offsetHeight,left:b.offsetLeft};while(b=b.offsetParent)a.top+=b.offsetTop,a.left+=b.offsetLeft;return a},b.prototype._hideResults=function(){var a,b,c,d,e;this._applyStyle("display","none"),this.results=[],d=this.services,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.results=[]);return e},b.prototype._displayResults=function(){var a;return a=this._getPosition(),this._applyStyle("left",""+a.left+"px"),this._applyStyle("top",""+a.top+"px"),this._applyStyle("display","block")},b.prototype._renderItem=function(a,b){var c;return c=document.createElement("li"),c.innerHTML=a,b!=null&&c.setAttribute("class",b),c},b.prototype._renderFooter=function(){return this._renderItem(this.options.footerContent,this.options.footer_class)},b.prototype._renderEmpty=function(){return this._renderItem(this.options.emptyContent,this.options.empty_class)},b.prototype._servicesReady=function(){var a,b,c,d,e;b=[],e=this.services;for(c=0,d=e.length;c<d;c++)a=e[c],b.push(a.ready);return b.indexOf(!1)<0},b.prototype.showResults=function(){var a,b,c,d,e,f,g,h,i;if(this._servicesReady()){this.results=[],this.output.innerHTML="",h=this.services;for(d=0,f=h.length;d<f;d++)c=h[d],this.results=this.results.concat(c.results);if(this.results.length){this.results=this.results.sort(function(a,b){return b.score-a.score}),this.results=this.results.slice(0,this.getOption("max_results")-1+1||9e9),i=this.results;for(e=0,g=i.length;e<g;e++)b=i[e],this.output.appendChild(b.render());this.options.footerContent!=null&&(a=this._renderFooter())!==""&&this.output.appendChild(a),this._displayResults()}else this.options.emptyContent!=null?(this.output.appendChild(this._renderEmpty()),this._displayResults(),this.trigger("results:empty")):this._hideResults();return this.trigger("results:update")}},b.prototype.selectHighlighted=function(){return this.element.value=this.highlighted.value,this._hideResults(),this.trigger("result:select",this.highlighted.value,this.highlighted.data)},b}(NeatComplete.Dispatch)})).call(this);