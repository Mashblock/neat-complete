// Neat Complete v1.2.0 
//
// (c) 2014 Abletech Ltd. 
// http://abletech.github.com/neat-complete/doc/LICENSE.md.html

(function(){var a=[].slice,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};!function(a,b){return"function"==typeof define&&define.amd?define(function(){return b(a)}):a.NeatComplete=b(a)}(this,function(){var c;return c={},c.addDomEvent=function(a,b,c){return null!=a.attachEvent?(a["e"+b+c]=c,a[""+b+c]=function(){return a["e"+b+c](window.event)},a.attachEvent("on"+b,a[""+b+c])):a.addEventListener(b,c,!1)},c.removeDomEvent=function(a,b,c){return null!=a.detachEvent?a.detachEvent("on"+b,a[""+b+c]):a.removeEventListener(b,c,!1)},Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b,c,d,e;if("undefined"==typeof this||null===this)throw new TypeError;if(e=Object(this),c=e.length>>>0,0===c)return-1;if(d=0,arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&1/0!==d&&d!==-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(b=d>=0?d:Math.max(c-Math.abs(d),0);c>b;){if(b in e&&e[b]===a)return b;b++}return-1}),c.Dispatch=function(){function b(){}return b.prototype.setOption=function(a,b){return this.options[a]=b,this},b.prototype.getOption=function(a){return this.options[a]},b.prototype.on=function(a,b){var c;return null==this.subs&&(this.subs={}),null==(c=this.subs)[a]&&(c[a]=[]),this.subs[a].push(b),this},b.prototype.trigger=function(){var b,c,d,e,f,g,h;if(d=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],null!=(null!=(g=this.subs)?g[d]:void 0))for(h=this.subs[d],e=0,f=h.length;f>e;e++)c=h[e],c.apply(this,b);return this},b}(),c.Widget=function(a){function e(a,c){this.element=a,this.options=null!=c?c:{},this._onBlur=b(this._onBlur,this),this._onKeyDown=b(this._onKeyDown,this),this._onKeyPress=b(this._onKeyPress,this),this._onFocus=b(this._onFocus,this),this.enabled=!0,this.element.setAttribute("autocomplete","off"),this.services=[],this._applyDefaults(),null==this.getOption("container")&&this.setOption("container",window.document.body),this._addListeners(),this.output=document.createElement("ul"),this.output.className=this.options.list_class,this._applyStyle("display","none"),this._applyStyle("position",this.options.position),this.options.container.appendChild(this.output)}return d(e,a),e.prototype.defaults={max_results:10,list_class:"nc_list",item_class:"nc_item",hover_class:"nc_hover",footer_class:"nc_footer",empty_class:"nc_empty",error_class:"nc_error",position:"absolute"},e.prototype.addService=function(a,b,d){var e;return null==d&&(d={}),this.services.push(e=new c.Service(this,a,b,d)),e},e.prototype.disable=function(){return this.enabled=!1,this},e.prototype.enable=function(){return this.enabled=!0,this},e.prototype.destroy=function(){document.body.removeChild(this.output),this.element.removeAttribute("autocomplete")},e.prototype._getContainer=function(){},e.prototype._applyDefaults=function(){var a,b,c,d;c=this.defaults,d=[];for(a in c)b=c[a],d.push(null==this.getOption(a)?this.setOption(a,b):void 0);return d},e.prototype._addListeners=function(){return c.addDomEvent(this.element,"focus",this._onFocus),c.addDomEvent(this.element,"keypress",this._onKeyPress),c.addDomEvent(this.element,"keydown",this._onKeyDown),c.addDomEvent(this.element,"blur",this._onBlur)},e.prototype._removeListeners=function(){return c.removeDomEvent(this.element,"focus",this._onFocus),c.removeDomEvent(this.element,"keypress",this._onKeyPress),c.removeDomEvent(this.element,"keydown",this._onKeyDown),c.removeDomEvent(this.element,"blur",this._onBlur)},e.prototype._onFocus=function(){return this.focused=!0},e.prototype._onKeyPress=function(a){var b,c;return b=a.which||a.keyCode,this.visible&&13===b?(null!=(c=this.highlighted)&&c.selectItem(),a.preventDefault?a.preventDefault():a.returnValue=!1,!1):void 0},e.prototype._onKeyDown=function(a){var b,c,d=this;switch(b=a.which||a.keyCode){case 38:return this.visible&&this._moveHighlight(-1),!1;case 40:return this.visible&&this._moveHighlight(1),!1;case 9:if(this.visible)return null!=(c=this.highlighted)?c.selectItem():void 0;break;case 27:return this._hideResults();case 37:case 39:case 13:break;default:return null!=this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(){return d._getSuggestions()},400)}},e.prototype._onBlur=function(){return this.mouseDownOnSelect?void 0:(this.focused=!1,this._hideResults())},e.prototype._moveHighlight=function(a){var b,c,d;return b=null!=this.highlighted?this.results.indexOf(this.highlighted):-1,null!=(c=this.highlighted)&&c.unhighlight(),b+=a,-1>b?b=this.results.length-1:b>=this.results.length&&(b=-1),null!=(d=this.results[b])&&d.highlight(),this.element.value=null!=this.highlighted?this.highlighted.value:this._val},e.prototype._getSuggestions=function(){var a,b,c,d,e;if(this.enabled){if(this._val=this.element.value,this.error_content=null,""!==this._val){for(d=this.services,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.search(this._val));return e}return this._hideResults()}},e.prototype._applyStyle=function(a,b){return this.output.style[a]=b},e.prototype._getPosition=function(){var a,b;for(b=this.element,a={top:b.offsetTop+b.offsetHeight,left:b.offsetLeft};b=b.offsetParent;)a.top+=b.offsetTop,a.left+=b.offsetLeft;return a},e.prototype._hideResults=function(){var a,b,c,d,e;for(this.visible=!1,this._applyStyle("display","none"),this.results=[],d=this.services,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.results=[]);return e},e.prototype._displayResults=function(){var a;return this.visible=!0,a=this._getPosition(),this.options.container===document.body&&(this._applyStyle("left",""+a.left+"px"),this._applyStyle("top",""+a.top+"px")),this._applyStyle("display","block")},e.prototype._renderItem=function(a,b){var d,e=this;return d=document.createElement("li"),d.innerHTML=a,null!=b&&(d.className=b),c.addDomEvent(d,"mousedown",function(){return e.mouseDownOnSelect=!0}),c.addDomEvent(d,"mouseup",function(){return e.mouseDownOnSelect=!1}),d},e.prototype._renderFooter=function(){return this._renderItem(this.options.footer_content,this.options.footer_class)},e.prototype._renderEmpty=function(){return this._renderItem(this.options.empty_content,this.options.empty_class)},e.prototype._servicesReady=function(){var a,b,c,d,e;for(b=[],e=this.services,c=0,d=e.length;d>c;c++)a=e[c],b.push(a.ready);return b.indexOf(!1)<0},e.prototype.showResults=function(){var a,b,c,d,e,f,g,h,i;if(this._servicesReady()){for(this.results=[],this.output.innerHTML="",h=this.services,d=0,f=h.length;f>d;d++)c=h[d],this.results=this.results.concat(c.results);if(this.results.length){for(this.results=this.results.sort(function(a,b){return b.score-a.score}),this.results=this.results.slice(0,+(this.getOption("max_results")-1)+1||9e9),i=this.results,e=0,g=i.length;g>e;e++)b=i[e],this.output.appendChild(b.render());null!=this.options.footer_content&&""!==(a=this._renderFooter())&&this.output.appendChild(a),this._displayResults()}else this.error_content?(this.output.appendChild(this._renderItem(this.error_content,this.options.error_class)),this._displayResults()):(null!=this.options.empty_content?(this.output.appendChild(this._renderEmpty()),this._displayResults()):this._hideResults(),this.trigger("results:empty"));this.trigger("results:update")}},e.prototype.selectHighlighted=function(){this.element.value=this.highlighted.value,this._hideResults(),this.trigger("result:select",this.highlighted.value,this.highlighted.data)},e}(c.Dispatch),c.Service=function(a){function e(a,c,d,e){var f=this;this.widget=a,this.name=c,this.search_fn=d,this.options=null!=e?e:{},this._response=b(this._response,this),this.results=[],this.response=function(){return f._response.apply(f,arguments)}}return d(e,a),e.prototype.search=function(a){return this.last_query=a,this.ready=!1,this.search_fn(a,this.response)},e.prototype._response=function(a,b){var d,e,f;if(this.results=[],this.last_query===a){for(this.results=[],e=0,f=b.length;f>e;e++)d=b[e],this.results.push(new c._Result(this,d));return this.ready=!0,this.widget.showResults()}},e}(c.Dispatch),c._Result=function(){function a(a,b){var c,d,e,f;this.service=a,this.options=b,this.widget=this.service.widget,this.renderer=this.service.options.renderer||this.widget.options.renderer,this.value=null!=(c=this.options)?c.value:void 0,this.score=(null!=(d=this.options)?d.score:void 0)||0,this.identifier=null!=(e=this.options)?e.identifier:void 0,this.data=(null!=(f=this.options)?f.data:void 0)||{}}return a.prototype.render=function(){return this.li=document.createElement("li"),this.li.innerHTML=null!=this.renderer?this.renderer(this.value,this.data):this.value,this.li.className=this.widget.options.item_class,this.addEvents(),this.li},a.prototype.addEvents=function(){var a=this;return c.addDomEvent(this.li,"click",function(b){return a.selectItem(),b.preventDefault?b.preventDefault():b.returnValue=!1}),c.addDomEvent(this.li,"mouseover",function(){return a.highlight()}),c.addDomEvent(this.li,"mouseout",function(){return a.unhighlight()}),c.addDomEvent(this.li,"mousedown",function(){return a.widget.mouseDownOnSelect=!0}),c.addDomEvent(this.li,"mouseup",function(){return a.widget.mouseDownOnSelect=!1})},a.prototype.selectItem=function(){return this.service.trigger("result:select",this.value,this.data),this.widget.highlighted=this,this.widget.selectHighlighted()},a.prototype.highlight=function(){var a;return null!=(a=this.widget.highlighted)&&a.unhighlight(),this.li.className=""+this.li.className+" "+this.widget.options.hover_class,this.widget.highlighted=this},a.prototype.unhighlight=function(){return this.widget.highlighted=null,this.li.className=this.li.className.replace(new RegExp(this.widget.options.hover_class,"gi"),"")},a}(),c})}).call(this);
//# sourceMappingURL=neat_complete.min.js.map