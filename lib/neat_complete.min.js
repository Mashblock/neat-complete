// neat_complete v1.1.0
//
// (c) 2013 Abletech Limited.
// http://abletech.github.com/neat-complete/doc/LICENSE.md.html
(function(){var t,e=[].slice;null==(t=window.NeatComplete)&&(window.NeatComplete={}),NeatComplete.Dispatch=function(){function t(){}return t.prototype.setOption=function(t,e){return this.options[t]=e,this},t.prototype.getOption=function(t){return this.options[t]},t.prototype.on=function(t,e){var i,s,n;return null==(s=this.subs)&&(this.subs={}),null==(n=(i=this.subs)[t])&&(i[t]=[]),this.subs[t].push(e),this},t.prototype.trigger=function(){var t,i,s,n,o,r,l;if(s=arguments[0],t=arguments.length>=2?e.call(arguments,1):[],null!=(null!=(r=this.subs)?r[s]:void 0))for(l=this.subs[s],n=0,o=l.length;o>n;n++)i=l[n],i.apply(this,t);return this},t}()}).call(this),function(){var t;null==(t=window.NeatComplete)&&(window.NeatComplete={}),NeatComplete.addDomEvent=function(t,e,i){return null!=t.attachEvent?(t["e"+e+i]=i,t[""+e+i]=function(){return t["e"+e+i](window.event)},t.attachEvent("on"+e,t[""+e+i])):t.addEventListener(e,i,!1)},Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e,i,s,n;if(this===void 0||null===this)throw new TypeError;if(n=Object(this),i=n.length>>>0,0===i)return-1;if(s=0,arguments.length>0&&(s=Number(arguments[1]),s!==s?s=0:0!==s&&1/0!==s&&s!==-1/0&&(s=(s>0||-1)*Math.floor(Math.abs(s)))),s>=i)return-1;for(e=s>=0?s:Math.max(i-Math.abs(s),0);i>e;){if(e in n&&n[e]===t)return e;e++}return-1})}.call(this),function(){var t;null==(t=window.NeatComplete)&&(window.NeatComplete={}),NeatComplete._Result=function(){function t(t,e){var i,s,n,o;this.service=t,this.options=e,this.widget=this.service.widget,this.renderer=this.service.options.renderer||this.widget.options.renderer,this.value=null!=(i=this.options)?i.value:void 0,this.score=(null!=(s=this.options)?s.score:void 0)||0,this.identifier=null!=(n=this.options)?n.identifier:void 0,this.data=(null!=(o=this.options)?o.data:void 0)||{}}return t.prototype.render=function(){return this.li=document.createElement("li"),this.li.innerHTML=null!=this.renderer?this.renderer(this.value,this.data):this.value,this.li.className=this.widget.options.item_class,this.addEvents(),this.li},t.prototype.addEvents=function(){var t=this;return NeatComplete.addDomEvent(this.li,"click",function(e){return t.selectItem(),e.preventDefault?e.preventDefault():e.returnValue=!1}),NeatComplete.addDomEvent(this.li,"mouseover",function(){return t.highlight()}),NeatComplete.addDomEvent(this.li,"mouseout",function(){return t.unhighlight()}),NeatComplete.addDomEvent(this.li,"mousedown",function(){return t.widget.mouseDownOnSelect=!0}),NeatComplete.addDomEvent(this.li,"mouseup",function(){return t.widget.mouseDownOnSelect=!1})},t.prototype.selectItem=function(){return this.service.trigger("result:select",this.value,this.data),this.widget.highlighted=this,this.widget.selectHighlighted()},t.prototype.highlight=function(){var t;return null!=(t=this.widget.highlighted)&&t.unhighlight(),this.li.className=""+this.li.className+" "+this.widget.options.hover_class,this.widget.highlighted=this},t.prototype.unhighlight=function(){return this.widget.highlighted=null,this.li.className=this.li.className.replace(RegExp(this.widget.options.hover_class,"gi"),"")},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,s=function(t,e){function s(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t};null==(t=window.NeatComplete)&&(window.NeatComplete={}),NeatComplete.Service=function(t){function i(t,i,s,n){var o=this;this.widget=t,this.name=i,this.search_fn=s,this.options=null!=n?n:{},this._response=e(this._response,this),this.results=[],this.response=function(){return o._response.apply(o,arguments)}}return s(i,t),i.prototype.search=function(t){return this.last_query=t,this.ready=!1,this.search_fn(t,this.response)},i.prototype._response=function(t,e){var i,s,n;if(this.results=[],this.last_query===t){for(this.results=[],s=0,n=e.length;n>s;s++)i=e[s],this.results.push(new NeatComplete._Result(this,i));return this.ready=!0,this.widget.showResults()}},i}(NeatComplete.Dispatch)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function s(){this.constructor=e}for(var n in i)t.call(i,n)&&(e[n]=i[n]);return s.prototype=i.prototype,e.prototype=new s,e.__super__=i.prototype,e};NeatComplete.Widget=function(t){function i(t,e){this.element=t,this.options=null!=e?e:{},this.element.setAttribute("autocomplete","off"),this.services=[],this._applyDefaults(),this._addListeners(),this.output=document.createElement("ul"),this.output.className=this.options.list_class,this._applyStyle("display","none"),this._applyStyle("position","absolute"),document.body.appendChild(this.output)}return e(i,t),i.prototype.defaults={max_results:10,list_class:"nc_list",item_class:"nc_item",hover_class:"nc_hover",footer_class:"nc_footer",empty_class:"nc_empty",error_class:"nc_error"},i.prototype.addService=function(t,e,i){var s;return null==i&&(i={}),this.services.push(s=new NeatComplete.Service(this,t,e,i)),s},i.prototype._applyDefaults=function(){var t,e,i,s;i=this.defaults,s=[];for(t in i)e=i[t],null==this.getOption(t)?s.push(this.setOption(t,e)):s.push(void 0);return s},i.prototype._addListeners=function(){var t=this;return NeatComplete.addDomEvent(this.element,"focus",function(){return t.focused=!0}),NeatComplete.addDomEvent(this.element,"keypress",function(e){var i,s;return i=e.which||e.keyCode,t.visible&&13===i?(null!=(s=t.highlighted)&&s.selectItem(),e.preventDefault?e.preventDefault():e.returnValue=!1,!1):void 0}),NeatComplete.addDomEvent(this.element,"keydown",function(e){var i,s;switch(i=e.which||e.keyCode){case 38:return t.visible&&t._moveHighlight(-1),!1;case 40:return t.visible&&t._moveHighlight(1),!1;case 9:if(t.visible)return null!=(s=t.highlighted)?s.selectItem():void 0;break;case 27:return t._hideResults();case 37:case 39:case 13:break;default:return null!=t._timeout&&clearTimeout(t._timeout),t._timeout=setTimeout(function(){return t._getSuggestions()},400)}}),NeatComplete.addDomEvent(this.element,"blur",function(){return t.mouseDownOnSelect?void 0:(t.focused=!1,t._hideResults())})},i.prototype._moveHighlight=function(t){var e,i,s;return e=null!=this.highlighted?this.results.indexOf(this.highlighted):-1,null!=(i=this.highlighted)&&i.unhighlight(),e+=t,-1>e?e=this.results.length-1:e>=this.results.length&&(e=-1),null!=(s=this.results[e])&&s.highlight(),this.element.value=null!=this.highlighted?this.highlighted.value:this._val},i.prototype._getSuggestions=function(){var t,e,i,s,n;if(this._val=this.element.value,this.error_content=null,""!==this._val){for(s=this.services,n=[],e=0,i=s.length;i>e;e++)t=s[e],n.push(t.search(this._val));return n}return this._hideResults()},i.prototype._applyStyle=function(t,e){return this.output.style[t]=e},i.prototype._getPosition=function(){var t,e;for(e=this.element,t={top:e.offsetTop+e.offsetHeight,left:e.offsetLeft};e=e.offsetParent;)t.top+=e.offsetTop,t.left+=e.offsetLeft;return t},i.prototype._hideResults=function(){var t,e,i,s,n;for(this.visible=!1,this._applyStyle("display","none"),this.results=[],s=this.services,n=[],e=0,i=s.length;i>e;e++)t=s[e],n.push(t.results=[]);return n},i.prototype._displayResults=function(){var t;return this.visible=!0,t=this._getPosition(),this._applyStyle("left",""+t.left+"px"),this._applyStyle("top",""+t.top+"px"),this._applyStyle("display","block")},i.prototype._renderItem=function(t,e){var i,s=this;return i=document.createElement("li"),i.innerHTML=t,null!=e&&(i.className=e),NeatComplete.addDomEvent(i,"mousedown",function(){return s.mouseDownOnSelect=!0}),NeatComplete.addDomEvent(i,"mouseup",function(){return s.mouseDownOnSelect=!1}),i},i.prototype._renderFooter=function(){return this._renderItem(this.options.footer_content,this.options.footer_class)},i.prototype._renderEmpty=function(){return this._renderItem(this.options.empty_content,this.options.empty_class)},i.prototype._servicesReady=function(){var t,e,i,s,n;for(e=[],n=this.services,i=0,s=n.length;s>i;i++)t=n[i],e.push(t.ready);return 0>e.indexOf(!1)},i.prototype.showResults=function(){var t,e,i,s,n,o,r,l,h;if(this._servicesReady()){for(this.results=[],this.output.innerHTML="",l=this.services,s=0,o=l.length;o>s;s++)i=l[s],this.results=this.results.concat(i.results);if(this.results.length){for(this.results=this.results.sort(function(t,e){return e.score-t.score}),this.results=this.results.slice(0,+(this.getOption("max_results")-1)+1||9e9),h=this.results,n=0,r=h.length;r>n;n++)e=h[n],this.output.appendChild(e.render());null!=this.options.footer_content&&""!==(t=this._renderFooter())&&this.output.appendChild(t),this._displayResults()}else this.error_content?(this.output.appendChild(this._renderItem(this.error_content,this.options.error_class)),this._displayResults()):null!=this.options.empty_content?(this.output.appendChild(this._renderEmpty()),this._displayResults(),this.trigger("results:empty")):this._hideResults();this.trigger("results:update")}},i.prototype.selectHighlighted=function(){this.element.value=this.highlighted.value,this._hideResults(),this.trigger("result:select",this.highlighted.value,this.highlighted.data)},i}(NeatComplete.Dispatch)}.call(this);