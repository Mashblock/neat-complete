// Generated by CoffeeScript 1.3.1
/**
  * Copyright 2012 Able Technology
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  * http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
  *
*/((function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};window.NeatComplete==null&&(window.NeatComplete={}),NeatComplete.addDomEvent=function(a,b,c){return a.attachEvent!=null?(a["e"+b+c]=c,a[""+b+c]=function(){return a["e"+b+c](window.event)},a.attachEvent("on"+b,a[""+b+c])):a.addEventListener(b,c,!1)},window.NeatComplete==null&&(window.NeatComplete={}),NeatComplete._Result=function(){function a(a,b){var c,d,e,f;this.service=a,this.options=b,this.widget=this.service.widget,this.value=(c=this.options)!=null?c.value:void 0,this.score=((d=this.options)!=null?d.score:void 0)||0,this.identifier=(e=this.options)!=null?e.identifier:void 0,this.data=((f=this.options)!=null?f.data:void 0)||{}}return a.name="_Result",a.prototype.render=function(){return this.li=document.createElement("li"),this.li.innerHTML=this.value,this.li.setAttribute("class","nc_item"),this.addEvents(),this.li},a.prototype.addEvents=function(){var a=this;return NeatComplete.addDomEvent(this.li,"click",function(b){return a.widget.selectHighlighted(),b.preventDefault?b.preventDefault():b.returnValue=!1}),NeatComplete.addDomEvent(this.li,"mouseover",function(){return a.highlight()}),NeatComplete.addDomEvent(this.li,"mouseout",function(){return a.unhighlight()}),NeatComplete.addDomEvent(this.li,"mousedown",function(){return a.widget.mouseDownOnSelect=!0}),NeatComplete.addDomEvent(this.li,"mouseup",function(){return a.widget.mouseDownOnSelect=!1})},a.prototype.highlight=function(){var a;return(a=this.widget.highlighted)!=null&&a.unhighlight(),this.li.className=""+this.li.className+" nc_hover",this.widget.highlighted=this},a.prototype.unhighlight=function(){return this.widget.highlighted=null,this.li.className=this.li.className.replace(new RegExp("nc_hover","gi"),"")},a}(),window.NeatComplete==null&&(window.NeatComplete={}),NeatComplete._Service=function(){function b(b,c,d,e){var f=this;this.widget=b,this.name=c,this.search_fn=d,this.options=e!=null?e:{},this._response=a(this._response,this),this.results=[],this.response=function(a,b){return f._response.apply(f,arguments)}}return b.name="_Service",b.prototype.search=function(a){return this.last_query=a,this.search_fn(a,this.response)},b.prototype._response=function(a,b){var c,d,e;this.results=[];if(this.last_query===a){this.results=[];for(d=0,e=b.length;d<e;d++)c=b[d],this.results.push(new NeatComplete._Result(this,c));return typeof console!="undefined"&&console!==null&&console.log(this.results),this.widget.showResults()}},b}(),window.NeatComplete==null&&(window.NeatComplete={}),NeatComplete.Widget=function(){function a(a,b){this.element=a,this.options=b!=null?b:{},typeof console!="undefined"&&console!==null&&console.log(this.element),this.element.setAttribute("autocomplete","off"),this.services=[],this._addListeners(),this.output=document.createElement("ul"),this.output.setAttribute("class","nc_list"),this._applyStyle("display","none"),this._applyStyle("position","absolute"),document.body.appendChild(this.output)}return a.name="Widget",a.prototype.max_results=10,a.prototype.addService=function(a,b){return this.services.push(new NeatComplete._Service(this,a,b))},a.prototype._addListeners=function(){var a=this;return NeatComplete.addDomEvent(this.element,"focus",function(b){return a.focused=!0}),NeatComplete.addDomEvent(this.element,"keypress",function(b){var c;c=b.which||b.keyCode;if(c===13)return a.highlighted!=null&&a.selectHighlighted(),b.preventDefault?b.preventDefault():b.returnValue=!1,!1}),NeatComplete.addDomEvent(this.element,"keydown",function(b){var c;c=b.which||b.keyCode;switch(c){case 38:return a._moveHighlight(-1),!1;case 40:return a._moveHighlight(1),!1;case 9:if(a._highlighted!=null)return a._selectHighlighted();break;case 27:return a._hideResults();case 37:case 39:case 13:break;default:return a._timeout!=null&&clearTimeout(a._timeout),a._timeout=setTimeout(function(){return a._getSuggestions()},400)}}),NeatComplete.addDomEvent(this.element,"blur",function(b){if(!a.mouseDownOnSelect)return a.focused=!1,a._hideResults()})},a.prototype._moveHighlight=function(a){var b,c,d;return b=this.highlighted!=null?this.results.indexOf(this.highlighted):-1,(c=this.highlighted)!=null&&c.unhighlight(),b+=a,b<-1?b=this.results.length-1:b>=this.results.length&&(b=-1),(d=this.results[b])!=null&&d.highlight(),this.element.value=this.highlighted!=null?this.highlighted.value:this._val},a.prototype._getSuggestions=function(){var a,b,c,d,e;this._val=this.element.value;if(this._val!==""){d=this.services,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.search(this._val));return e}return this._hideResults()},a.prototype._applyStyle=function(a,b){return this.output.style[a]=b},a.prototype._getPosition=function(){var a,b;b=this.element,a={top:b.offsetTop+b.offsetHeight,left:b.offsetLeft};while(b=b.offsetParent)a.top+=b.offsetTop,a.left+=b.offsetLeft;return a},a.prototype._hideResults=function(){var a,b,c,d,e;this._applyStyle("display","none"),this.results=[],d=this.services,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.results=[]);return e},a.prototype._displayResults=function(){var a;return a=this._getPosition(),this._applyStyle("left",""+a.left+"px"),this._applyStyle("top",""+a.top+"px"),this._applyStyle("display","block")},a.prototype.showResults=function(){var a,b,c,d,e,f,g,h;this.results=[],this.output.innerHTML="",g=this.services;for(c=0,e=g.length;c<e;c++)b=g[c],this.results=this.results.concat(b.results);this.results=this.results.sort(function(a,b){return b.score-a.score}),this.results=this.results.slice(0,this.max_results-1+1||9e9),h=this.results;for(d=0,f=h.length;d<f;d++)a=h[d],this.output.appendChild(a.render());return this.results.length?this._displayResults():this._hideResults()},a.prototype.selectHighlighted=function(){return this.element.value=this.highlighted.value,this._hideResults()},a}()})).call(this);